## Overview

This directory contains the results of research into how the firmware in 
Syntor X9000 radios works.

The various info files for [f9dasm](https://github.com/Arakula/f9dasm)
provide code comments that f9dasm will include in disassemble listings of
Syntor X9000 EPROMs.

These comments were generated by various researchers interested in the
internal workings of the X9000 over many years.

**YOU** are welcome to contribute either publically or anonymously.

The comments can be read as-is to provide some general ideas of how the
firmware operates or can be used with a USER PROVIDED binary file to
generate a commented listing.

## Generating a firmware listing

Obviously the X9000 firmware is Copyrighted by Motorola. Please do not ask
for images or firmware listings, they will **NOT** be provided.  However
you are free to create your own listings from your own EPROM.

There are numerous versions of firmware for the X9000.  We use the MD5 sum of the
contents of the EPROM as a unique identifier of the version. All information
for that firmware version is kept in a subdirectory named by the MD5 sum.
We'll call this the version subdirectory.

1. Install f9dasm from https://github.com/Arakula/f9dasm
1. Remove the EPROM from your X9000's personality board (U501) and read the contents using an EPROM programer.  Save the image as a raw binary file with a filename of eprom.bin.
2. Run md5sum on eprom.bin.
3. Check if the version subdirectory exists, if not create it.
4. Move the EPROM image into the version subdirectory.
5. cd into the version subdirectory.
6. run ../disassemble.sh eprom.bin

The disassemble script will create eprom.lst from your eprom.bin

**NB:** A "Unix Like" operating system is assumed, i.e. Linux or possibly macOS.  

It may be possible to use Windows, but I haven't tried it and don't recommend it.

For example
```
skip@Dell-7040:~/xcat/xcat_ng_fw/research$ md5sum eprom.bin
678f8f35b4a2f44926ab67c3b64c4bd4  eprom.bin
skip@Dell-7040:~/xcat/xcat_ng_fw/research$ mkdir 678f8f35b4a2f44926ab67c3b64c4bd4
skip@Dell-7040:~/xcat/xcat_ng_fw/research$ mv eprom.bin 678f8f35b4a2f44926ab67c3b64c4bd4/
skip@Dell-7040:~/xcat/xcat_ng_fw/research$ cd 678f8f35b4a2f44926ab67c3b64c4bd4/
skip@Dell-7040:~/xcat/xcat_ng_fw/research/678f8f35b4a2f44926ab67c3b64c4bd4$ ../disassemble.sh eprom.bin
eprom.bin
f9dasm: M6800/1/2/3/8/9 / H6309 Binary/OS9/FLEX9 Disassembler V1.80
Loaded binary file eprom.bin
skip@Dell-7040:~/xcat/xcat_ng_fw/research/678f8f35b4a2f44926ab67c3b64c4bd4$
skip@Dell-7040:~/xcat/xcat_ng_fw/research/678f8f35b4a2f44926ab67c3b64c4bd4$ ll
total 1796
drwxrwxr-x 2 skip skip   4096 Aug 24 10:45 ./
drwxrwxr-x 3 skip skip   4096 Aug 24 10:45 ../
-rw-rw-r-- 1 skip skip      0 Aug 24 10:44 comments.nfo
-rwxrw-r-- 1 skip skip  16384 Aug 24 06:28 eprom.bin*
-rw-rw-r-- 1 skip skip 550268 Aug 24 10:44 eprom.lst
-rw-rw-r-- 1 skip skip     43 Aug 24 10:44 eprom.nfo
```

# Scripts
## disassemble.sh

Usage: disassemble [--pretty] \<imagefile>

This script runs f9dasm on the specifed binary file.  Empty .nfo files are created
if they don't already exist.  If the listing file already exists it is renamed .bak.

The --pretty option creates a more user friendly file by omitting hex dumps

**NB**: Do **NOT** use the --pretty option if you plan on editing the listing, the
non-pretty version includes information needed by lst2nfo.py.

for example:
```
skip@Dell-7040:~/xcat/xcat_ng_fw/research/678f8f35b4a2f44926ab67c3b64c4bd4$ ../disassemble.sh eprom.bin
f9dasm: M6800/1/2/3/8/9 / H6309 Binary/OS9/FLEX9 Disassembler V1.80
Loaded binary file eprom.bin
```

## lst2nfo.py

This script creates an .nfo file from comments in a listing file generated by d9dasm.

Usage: lst2nfo \<list file generated by f9dasm> \<nfo file to generate>

for example:
```
skip@Dell-7040:~/xcat/xcat_ng_fw/research/678f8f35b4a2f44926ab67c3b64c4bd4$ ../lst2nfo.py eprom.lst comments.nfo
```

## ida2info.sh

If you use IDA Pro to facilitate your research the ida2info.sh script can
be used to create an f9dasm .nfo file containing the comments from your IDA 
generated listings.

Usage ida2info.sh \<listing file> \<f9dasm info file>

for example:
```
skip@Dell-7040:~/xcat/xcat_ng_fw/research/678f8f35b4a2f44926ab67c3b64c4bd4$ ../ida2info.sh ida_pro.lst comments.nfo
```

## cp_dump.py

Dumps X9000 code plug files to test our understanding of the format.

Usage cp_dump.py \<binary dump or .RDF file>

for example:
```
skip@Dell-7040:~/xcat/xcat_ng_fw/research$ ./cp_dump.py -f 10M6MTST.RDT
dumping 10M6MTST.RDT
EEPROM length 2048, checksum 0x5c6e
Checksum is valid
SB9600 address 0x01
32 modes:
Mode table has 24 bytes entries
Radio range 29.7 - 50.0 Mhz
Mode 1:
frx 29.6
ftx 29.6
ftalk_around 29.5

Rx PL 103.5
Tx PL 103.5
Mode 2:
frx 52.525
ftx 52.525
ftalk_around 53.0

Rx PL 123.0
Tx PL 141.3
Mode 3:
frx 52.525
ftx 52.525
ftalk_around 53.0

Rx PL 141.3
Tx PL 103.5
Mode 4:
frx 29.6
ftx 29.6
ftalk_around 29.5

Tx PL 123.0
```

# Contributing

To assist with the reverse engineering effort:

1. Create a commented listing of your EPROM.
2. Edit the listing file adding your research results as comments.
3. Create a new comments.nfo file from your edited listing.
4. Email your updated comments.nfo file to the xcat mailing list with a summary of what you have discovered.
5. Rinse, repeat...

Note: when adding comments on an existing line add them after the hex values of the address and instruction.

For example this snippet 
```
        LDAA    #$04                     ;C051: 86 04
        STAA    PORT5DDR                 ;C053: 97 20 
```
might become

```
        LDAA    #$04                     ;C051: 86 04          Make Port 5 pin 2 an output
        STAA    PORT5DDR                 ;C053: 97 20 
```

The lst2nfo.py script will extract "Make Port 5 pin 2 an output" from the listing and create an entry in comments.nfo capturing the comment.

```
lcomment C051 Make Port 5 pin 2 an output
```




